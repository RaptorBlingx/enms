┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                  GRAFANA DASHBOARD BACKUP - QUICK REFERENCE           ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

⚠️  CRITICAL REMINDER
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  Grafana UI changes are NOT automatically saved to git!
  
  You MUST export dashboards before committing to avoid data loss.


📋 THE WORKFLOW
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  1. Make changes in Grafana UI
     → Edit panels, queries, layouts, etc.
     → http://localhost:3000

  2. Export dashboards to JSON files
     → Run: ./scripts/backup-grafana-dashboards.sh

  3. Commit to git (your normal workflow)
     → git add .
     → git commit -m "Update Grafana dashboards"
     → git push


⌨️  AUTOMATIC BACKUP
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ✨ AUTO-BACKUP IS ENABLED! ✨
  
  Dashboards are automatically exported every 10 minutes.
  You don't need to run anything - just edit and commit!
  
  Manual backup (optional):
  ./scripts/backup-grafana-dashboards.sh
  
  Check status:
  sudo systemctl status grafana-backup.timer
  
  View logs:
  tail -f logs/grafana-backup.log


✅ WHAT'S SAFE (NO ACTION NEEDED)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  Node-RED:
  • Changes automatically saved to nodered/data/flows.json
  • No manual export required
  • Just git add, commit, push as usual


⚠️  WHAT NEEDS EXPORT
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  Grafana:
  • UI changes saved to Docker volume (not in git)
  • Must run backup script to export to JSON files
  • Then git add, commit, push


🚫 WHAT NOT TO DO
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ✗ docker compose down -v
    → Deletes volumes, loses all Grafana changes!
    
  ✗ git commit without running backup script
    → Your dashboard changes won't be in the commit!
    
  ✗ Manually editing JSON files instead of using UI
    → Can work, but UI is easier and less error-prone


📚 DOCUMENTATION
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  Detailed guide:        docs/GRAFANA-PERSISTENCE.md
  Quick reference:       grafana/README.md
  Implementation notes:  docs/SESSION-GRAFANA-PERSISTENCE.md
  Main README warning:   README.md (after "Quick Start")


💡 PRO TIPS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  • Run backup script before EVERY commit (if you changed Grafana)
  • Set up a cron job to auto-export hourly (see docs)
  • Use git diff to see what changed in dashboards
  • Backup script is safe to run multiple times


🆘 TROUBLESHOOTING
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  Script fails?
  → Check Grafana is running: docker compose ps grafana
  → Check API: curl -f http://localhost:3001/api/health
  → Check credentials in .env file

  Dashboards not appearing?
  → Restart Grafana: docker compose restart grafana
  → Check logs: docker compose logs grafana --tail=50

  Lost changes already?
  → If volume still exists: restart containers and export
  → If volume deleted: changes permanently lost (restore from backup)


📊 CURRENT DASHBOARDS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  • enms-energy-analysis      (Energy consumption analysis)
  • enms-factory-overview     (Factory-wide overview)
  • enms-machine-monitoring   (Individual machine monitoring)


🔁 EXAMPLE WORKFLOW
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  # 1. Make changes in Grafana
  
  # 2. Export dashboards
  $ ./scripts/backup-grafana-dashboards.sh
  
  ======================================================================
  EnMS - Grafana Dashboard Backup
  ======================================================================
  ✅ Grafana is running
  📋 Fetching dashboard list...
  Found 3 dashboard(s)
  📤 Exporting: Energy Analysis (enms-energy-analysis)
     ✅ Saved to: ./grafana/dashboards/enms-energy-analysis.json
  [...]
  ✅ Exported: 3
  
  # 3. Review changes
  $ git diff grafana/dashboards/
  
  # 4. Commit (your normal workflow)
  $ git add .
  $ git commit -m "Update dashboard: add power factor panel"
  $ git push
  
  # Done! ✅ Changes are now in git and safe


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  Remember: When in doubt, export!
  The backup script is safe to run anytime.

  Questions? See docs/GRAFANA-PERSISTENCE.md

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
